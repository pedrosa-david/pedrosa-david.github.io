<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hardened External Memory Controller (HEMC) | Microchip Documentation</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .sidebar {
            position: fixed;
            top: 0;
            bottom: 0;
            left: 0;
            z-index: 100;
            padding: 48px 0 0;
            box-shadow: inset -1px 0 0 rgba(0, 0, 0, .1);
            overflow: hidden;
            width: 280px;
        }

        .nav-frame {
            width: 100%;
            height: 100%;
            border: none;
            overflow-y: scroll;
            overflow-x: hidden;
        }

        .main {
            margin-left: 280px;
            padding: 20px;
        }

        .nav-link {
            color: #333;
            padding: .5rem 1rem;
        }

        .nav-link.active {
            background-color: #f8f9fa;
            font-weight: 500;
        }

        .parameters-table {
            width: 100%;
            margin-bottom: 1rem;
            background-color: #f8f9fa;
        }
    </style>
</head>

<body>
    <div class="container-fluid">
        <div class="row">
            <nav class="sidebar">
                <iframe class="nav-frame" src="navigation.html" title="Navigation"></iframe>
            </nav>
            <main class="main">
<div class="doc-navigation">
    <a href="section_3.44.html">↑ Up to Section</a><br />
    <a href="index.html">↑↑ Back to Main Documentation</a>
</div>

<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="index.html">Home</a></li>
        <li class="breadcrumb-item"><a href="section_3.html">Device Families</a></li>
        <li class="breadcrumb-item"><a href="section_3.44.html">SAM RH707 Peripheral Libraries</a></li>
        <li class="breadcrumb-item active" aria-current="page">Hardened External Memory Controller (HEMC)</li>
    </ol>
</nav>

<h1>Hardened External Memory Controller (HEMC)</h1>
<h1>3.44.6</h1>
<p>Hardened External Memory Controller (HEMC)</p>
<p><em>Generated on: 2025-02-19 08:42:44</em></p>
<p>Source: <a href="https://onlinedocs.microchip.com/oxy/GUID-450989FA-38E4-4D68-AB61-15ADB29AD718-en-US-5/GUID-015FBD0F-1284-4050-86E5-808B865815A0.html">https://onlinedocs.microchip.com/oxy/GUID-450989FA-38E4-4D68-AB61-15ADB29AD718-en-US-5/GUID-015FBD0F-1284-4050-86E5-808B865815A0.html</a></p>
<h1>3.44.6 Hardened External Memory Controller (HEMC)</h1>
<p>The HEMC System Memory interface provides a simple interface to manage the externally connected SDRAM, PROM and SRAM device.</p>
<h2>Using The Library</h2>
<p>The HEMC controller is initialized as configured in the MCC as part of System Initialization.</p>
<p>If interrupts are used, the callback function should be set for expected interrupts types:</p>
<p>When an ECC error is detected and an interrupt occurs, the fail address must be read before the status in order to avoid multiple interrupts:</p>
<p>The faulty address may then be fixed by the application if applicable.</p>
<p>Error injection test mode</p>
<p>ECC Check bit read</p>
<p>The ECC check bit value can be get when the read test mode is activated. Once this mode is activated, the check bit value for each read of data on HSMC or HSDRAMC memories is stored in corresponding registers. It is possible to get the last check bit value using the \function HEMC_TestModeGetCbValue.</p>
<p>Note: It is recommended to use memory barriers on Cortex-M core-based products where instructions can be executed out of programmed order, or to ensure that all memory transfers or instructions are completed before any new instruction is executed. In our application, we must ensure that register modification and memory transfers are completed before executing the next step.</p>
<p>ECC Check bit write</p>
<p>The ECC check bit value can be override when the write test mode is activated. Once this mode is activated, the check bit value for each write of data on HSMC or HSDRAMC memories is override by the given value instead of being calculated automatically. The check bit value used should be set using the function HEMC_TestModeSetCbValue.</p>
<p>Note: It is recommended to use memory barriers on Cortex-M core-based products where instructions can be executed out of programmed order, or to ensure that all memory transfers or instructions are completed before any new instruction is executed. In our application, we must ensure that register modification and memory transfers are completed before executing the next step.</p>
<p><pre class="code-block"><code class="language-c">/* Register Fixable errors Callback */
    HEMC_FixCallbackRegister(HEMC_FixCallback_Function, (uintptr_t)NULL);
    /* Register UnFixable errors Callback */
    HEMC_NoFixCallbackRegister(HEMC_NoFixCallback_Function, (uintptr_t)NULL);</code></pre></p>
<p>```C
/<em> Read the fault address before clearing the interrupt</em>/
    uint32_t<em> fault_pointer = (uint32_t</em>)HEMC_HeccGetFailAddress();</p>
<pre class="code-block"><code class="language-c">/* Only for Fixable error handler : Read corrected data on the Fly */
uint32_t fault_data = *fault_pointer;

/* Read HEMC HECC Status */
HEMC_HECC_STATUS value = HEMC_HeccGetStatus();
</code></pre>
<p>```</p>
<p>```C
/<em> Enable HEMC HECC Test mode Read in HSDRAMC memory </em>/
    HEMC_TestModeReadEnable(HEMC_HEMC_CH_HSDRAMC);
    __DSB();
    __ISB();</p>
<pre class="code-block"><code class="language-c">/* Read data in external memory */
data = buffer;
__DSB();
__ISB();

/* Get the Check Bit for last data read in HSDRAMC memory */
tcb = HEMC_TestModeGetCbValue(HEMC_HEMC_CH_HSDRAMC);
__DSB();
__ISB();

/* Disable HEMC HECC Test mode Read in HSDRAMC memory */
HEMC_TestModeReadDisable(HEMC_HEMC_CH_HSDRAMC);
</code></pre>
<p>```</p>
<p>```C
/<em> Enable HEMC HECC Test mode Write in HSDRAMC memory </em>/
    HEMC_TestModeWriteEnable(HEMC_HEMC_CH_HSDRAMC);
    __DSB();
    __ISB();</p>
<pre class="code-block"><code class="language-c">/* Set the Check Bit for override when data will be write in external HSDRAMC memory */
HEMC_TestModeSetCbValue(HEMC_HEMC_CH_HSDRAMC, tcb);
__DSB();
__ISB();

/* Write data in external memory */
buffer = data;
__DSB();
__ISB();

/* Disable HEMC HECC Test mode Write in HSDRAMC memory */
HEMC_TestModeWriteDisable(HEMC_HEMC_CH_HSDRAMC);
</code></pre>
<p>```</p>
<h2>Library Interface</h2>
<p>HEMC peripheral library provides the following interfaces:</p>
<p>Functions</p>
<p>Data types and constants</p>
<table class="data-table">
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>HEMC_Initialize</td>
<td>Initializes and Enables the HSDRAM and HSMC Controller</td>
</tr>
<tr>
<td>HEMC_HeccGetStatus</td>
<td>Get the HECC status of the HEMC peripheral</td>
</tr>
<tr>
<td>HEMC_DisableECC</td>
<td>Disable the ECC for the given chip select.</td>
</tr>
<tr>
<td>HEMC_EnableECC</td>
<td>Enable the ECC for the given chip select.</td>
</tr>
<tr>
<td>HEMC_HeccGetFailAddress</td>
<td>Get the last fail address were ECC error occurs in a HEMC memory</td>
</tr>
<tr>
<td>HEMC_HeccResetCounters</td>
<td>Reset Fix and NoFix error counters of the HEMC peripheral</td>
</tr>
<tr>
<td>HEMC_FixCallbackRegister</td>
<td>Sets the pointer to the function (and it's context) to be called when the given HEMC's ECC Fixable Error interrupt events occur</td>
</tr>
<tr>
<td>HEMC_NoFixCallbackRegister</td>
<td>Sets the pointer to the function (and it's context) to be called when the given HEMC's ECC Not Fixable Error interrupt events occur</td>
</tr>
<tr>
<td>HEMC_TestModeReadEnable</td>
<td>Enable the HEMC peripheral HECC test mode Read</td>
</tr>
<tr>
<td>HEMC_TestModeReadDisable</td>
<td>Disable the HEMC peripheral HECC test mode Read</td>
</tr>
<tr>
<td>HEMC_TestModeWriteEnable</td>
<td>Enable the HEMC peripheral HECC test mode Write</td>
</tr>
<tr>
<td>HEMC_TestModeWriteDisable</td>
<td>Disable the HEMC peripheral HECC test mode Write</td>
</tr>
<tr>
<td>HEMC_TestModeGetCbValue</td>
<td>Get the HEMC peripheral HECC test mode check bit values</td>
</tr>
<tr>
<td>HEMC_TestModeSetCbValue</td>
<td>Set the HEMC peripheral HECC test mode check bit values</td>
</tr>
<tr>
<td>HEMC_Write8</td>
<td>Writes 8 bit data at given address.</td>
</tr>
<tr>
<td>HEMC_Write16</td>
<td>Writes 16 bit data at given address.</td>
</tr>
<tr>
<td>HEMC_Write32</td>
<td>Writes 32 bit data at given address.</td>
</tr>
<tr>
<td>HEMC_Read8</td>
<td>Read 8 bit data at the given address.</td>
</tr>
<tr>
<td>HEMC_Read16</td>
<td>Read 16 bit data at the given address.</td>
</tr>
<tr>
<td>HEMC_Read32</td>
<td>Read 32 bit data at the given address.</td>
</tr>
</tbody>
</table>
<table class="data-table">
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>HEMC_HEMC_CHANNEL</td>
<td>Enum</td>
<td>Identifies the HEMC HECC channel</td>
</tr>
<tr>
<td>HEMC_HECC_STATUS</td>
<td>Enum</td>
<td>Identifies the HEMC HECC current status</td>
</tr>
<tr>
<td>HEMC_CALLBACK</td>
<td>Typedef</td>
<td>HEMC Callback Function Pointer</td>
</tr>
</tbody>
</table>
            </main>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>