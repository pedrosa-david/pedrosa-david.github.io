<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Input Capture (ICAP) | Microchip Documentation</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .sidebar {
            position: fixed;
            top: 0;
            bottom: 0;
            left: 0;
            z-index: 100;
            padding: 48px 0 0;
            box-shadow: inset -1px 0 0 rgba(0, 0, 0, .1);
            overflow: hidden;
            width: 280px;
        }

        .nav-frame {
            width: 100%;
            height: 100%;
            border: none;
            overflow-y: scroll;
            overflow-x: hidden;
        }

        .main {
            margin-left: 280px;
            padding: 20px;
        }

        .nav-link {
            color: #333;
            padding: .5rem 1rem;
        }

        .nav-link.active {
            background-color: #f8f9fa;
            font-weight: 500;
        }

        .parameters-table {
            width: 100%;
            margin-bottom: 1rem;
            background-color: #f8f9fa;
        }
    </style>
</head>

<body>
    <div class="container-fluid">
        <div class="row">
            <nav class="sidebar">
                <iframe class="nav-frame" src="navigation.html" title="Navigation"></iframe>
            </nav>
            <main class="main">
<div class="doc-navigation">
    <a href="section_3.20.html">↑ Up to Section</a><br />
    <a href="index.html">↑↑ Back to Main Documentation</a>
</div>

<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="index.html">Home</a></li>
        <li class="breadcrumb-item"><a href="section_3.html">Device Families</a></li>
        <li class="breadcrumb-item"><a href="section_3.20.html">PIC32MX 1XX 2XX XLP Peripheral Libraries</a></li>
        <li class="breadcrumb-item active" aria-current="page">Input Capture (ICAP)</li>
    </ol>
</nav>

<h1>Input Capture (ICAP)</h1>
<h1>3.20.10</h1>
<p>Input Capture (ICAP)</p>
<p><em>Generated on: 2025-02-19 08:42:44</em></p>
<p>Source: <a href="https://onlinedocs.microchip.com/oxy/GUID-450989FA-38E4-4D68-AB61-15ADB29AD718-en-US-5/GUID-6276C38F-009D-4350-9656-5BEA9E624EB2_6.html">https://onlinedocs.microchip.com/oxy/GUID-450989FA-38E4-4D68-AB61-15ADB29AD718-en-US-5/GUID-6276C38F-009D-4350-9656-5BEA9E624EB2_6.html</a></p>
<h1>3.20.10 Input Capture (ICAP)</h1>
<p>The Input Capture module is useful in applications requiring frequency (period) and pulse measurement.
The Input Capture module captures the 16-bit or 32-bit value of the selected Time Base registers when an event occurs at the ICx pin.
Capture events are caused by the following:</p>
<p>Capture timer value on every edge (rising and falling), specified edge first</p>
<p>Prescaler capture event modes:</p>
<p>Capture timer value on every 4th rising edge of input at ICx pin</p>
<p>Capture timer value on every 16th rising edge of input at ICx pin
Each input capture channel can select between one of six 16-bit timers for the time base, or two of six 16-bit timers together to form a 32-bit timer. The selected timer can use either an internal or external clock.</p>
<ul>
<li>Capture timer value on every edge (rising and falling), specified edge first</li>
<li>
<p>Prescaler capture event modes:</p>
<pre class="code-block"><code class="language-c">    Capture timer value on every 4th rising edge of input at ICx pin

    Capture timer value on every 16th rising edge of input at ICx pin
</code></pre>
<p>Each input capture channel can select between one of six 16-bit timers for the time base, or two of six 16-bit timers together to form a 32-bit timer. The selected timer can use either an internal or external clock.
- Capture timer value on every 4th rising edge of input at ICx pin
- Capture timer value on every 16th rising edge of input at ICx pin
Each input capture channel can select between one of six 16-bit timers for the time base, or two of six 16-bit timers together to form a 32-bit timer. The selected timer can use either an internal or external clock.</p>
</li>
<li>
<p>Capture timer value on every 4th rising edge of input at ICx pin</p>
</li>
<li>Capture timer value on every 16th rising edge of input at ICx pin
Each input capture channel can select between one of six 16-bit timers for the time base, or two of six 16-bit timers together to form a 32-bit timer. The selected timer can use either an internal or external clock.</li>
</ul>
<h2>Using The Library</h2>
<p>In this application, a pulse signal is generated using the OCMP peripheral and is fed to the ICAP input. ICAP peripheral captures the time at every edge and displays the pulse width on the serial terminal.</p>
<p>```C
uint16_t capturedValue[2];
volatile uint8_t captureIndex = 0;</p>
<p>int main ( void )
{
    /<em> Initialize all modules </em>/
    SYS_Initialize ( NULL );</p>
<pre class="code-block"><code class="language-c">ICAP1_Enable();

OCMP3_Enable();

TMR2_Start();

while ( true )
{
    /* Maintain state machines of all polled MPLAB Harmony modules. */
    SYS_Tasks ( );

    while(!ICAP1_CaptureStatusGet());

    capturedValue[captureIndex++] = ICAP1_CaptureBufferRead();

    if ( captureIndex &gt; 1){
        printf("Pulse Width Count = %d\r\n",(capturedValue[1] - capturedValue[0]));
        captureIndex = 0;
    }
}

/* Execution should not come here during normal operation */

return ( EXIT_FAILURE );
</code></pre>
<p>}
```</p>
<h2>Library Interface</h2>
<p>Peripheral library provides the following interfaces:</p>
<p>Functions</p>
<p>Data types and constants</p>
<table class="data-table">
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>ICAPx_Initialize</td>
<td>Initializes ICAPx module of the device</td>
</tr>
<tr>
<td>ICAPx_Enable</td>
<td>Enable function for the ICAPx peripheral</td>
</tr>
<tr>
<td>ICAPx_Disable</td>
<td>Disable function for the ICAPx peripheral</td>
</tr>
<tr>
<td>ICAPx_CaptureBufferRead</td>
<td>Read buffer function ICAPx peripheral</td>
</tr>
<tr>
<td>ICAPx_CaptureStatusGet</td>
<td>Reads current state buffer not empty status</td>
</tr>
<tr>
<td>ICAPx_ErrorStatusGet</td>
<td>Reads current state overflow status ICAPx status</td>
</tr>
<tr>
<td>ICAPx_CallbackRegister</td>
<td>Sets the callback function for a ICAPx interrupt</td>
</tr>
<tr>
<td>ICAPx_Error_CallbackRegister</td>
<td>Sets the callback function for a ICAP error interrupt</td>
</tr>
</tbody>
</table>
<table class="data-table">
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>ICAP_STATUS_SOURCE</td>
<td>Enum</td>
<td>Identifies ICAP status source mask</td>
</tr>
<tr>
<td>ICAP_CALLBACK</td>
<td>Typedef</td>
<td>Defines the function pointer data type and function signature for the ICAPx callback function</td>
</tr>
</tbody>
</table>
            </main>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>