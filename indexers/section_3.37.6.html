<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>High Speed MultiMedia Card Interface (HSMCI) | Microchip Documentation</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .sidebar {
            position: fixed;
            top: 0;
            bottom: 0;
            left: 0;
            z-index: 100;
            padding: 48px 0 0;
            box-shadow: inset -1px 0 0 rgba(0, 0, 0, .1);
            overflow: hidden;
            width: 280px;
        }

        .nav-frame {
            width: 100%;
            height: 100%;
            border: none;
            overflow-y: scroll;
            overflow-x: hidden;
        }

        .main {
            margin-left: 280px;
            padding: 20px;
        }

        .nav-link {
            color: #333;
            padding: .5rem 1rem;
        }

        .nav-link.active {
            background-color: #f8f9fa;
            font-weight: 500;
        }

        .parameters-table {
            width: 100%;
            margin-bottom: 1rem;
            background-color: #f8f9fa;
        }
    </style>
</head>

<body>
    <div class="container-fluid">
        <div class="row">
            <nav class="sidebar">
                <iframe class="nav-frame" src="navigation.html" title="Navigation"></iframe>
            </nav>
            <main class="main">
<div class="doc-navigation">
    <a href="section_3.37.html">↑ Up to Section</a><br />
    <a href="index.html">↑↑ Back to Main Documentation</a>
</div>

<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="index.html">Home</a></li>
        <li class="breadcrumb-item"><a href="section_3.html">Device Families</a></li>
        <li class="breadcrumb-item"><a href="section_3.37.html">SAM E70 S70 V70 V71 Peripheral Libraries</a></li>
        <li class="breadcrumb-item active" aria-current="page">High Speed MultiMedia Card Interface (HSMCI)</li>
    </ol>
</nav>

<h1>High Speed MultiMedia Card Interface (HSMCI)</h1>
<h1>3.37.6</h1>
<p>High Speed MultiMedia Card Interface (HSMCI)</p>
<p><em>Generated on: 2025-02-19 08:42:44</em></p>
<p>Source: <a href="https://onlinedocs.microchip.com/oxy/GUID-450989FA-38E4-4D68-AB61-15ADB29AD718-en-US-5/GUID-FA68646F-666C-4463-B3F2-4A28DCEEB1B7.html">https://onlinedocs.microchip.com/oxy/GUID-450989FA-38E4-4D68-AB61-15ADB29AD718-en-US-5/GUID-FA68646F-666C-4463-B3F2-4A28DCEEB1B7.html</a></p>
<h1>3.37.6 High Speed MultiMedia Card Interface (HSMCI)</h1>
<p>The HSMCI PLIB provides low level APIs to configure and transfer data using HSMCI. The HSMCI PLIB supports default and high speed data transfer, 1-bit and 4-bit data bus configurations. The PLIB performs the transfers in non-blocking mode. Transfers involving a data stage are performed using ADMA.</p>
<h2>Using The Library</h2>
<p>The example code demonstrates sending a SD command to read a single block of data from the SD card. This example assumes that the SD card is already initialized by the application and is ready to accept read and write requests. The example application does not show the larger SD protocol required in order to communicate with the SD card.</p>
<p>```C
uint16_t cmd_error;
uint16_t data_error;
bool isCommandCompleted = false;
bool isDataCompleted = false;
uint8_t readBuffer[512];</p>
<p>static void HSMCI_TransferEventHandler(
        HSMCI_XFER_STATUS xferStatus,
        uintptr_t contextHandle
)
{
    if (xferStatus &amp; HSMCI_XFER_STATUS_CMD_COMPLETED)
    {
        // Command transfer complete, read the command error status.
        cmd_error = HSMCI_CommandErrorGet();
        isCommandCompleted = true;
    }
    if (xferStatus &amp; HSMCI_XFER_STATUS_DATA_COMPLETED)
    {
        // Data transfer complete, read the data error status.
        data_error = HSMCI_DataErrorGet();
        isDataCompleted = true;
    }
}</p>
<p>int main ( void )
{
    /<em> Initialize all modules </em>/
    SYS_Initialize ( NULL );</p>
<pre class="code-block"><code class="language-c">// Register event handler with the HSMCI PLIB. This is usually done once.
HSMCI_CallbackRegister(HSMCI_TransferEventHandler, (uintptr_t) 0);

HSMCI_DataTransferFlags transferFlags;

transferFlags.isDataPresent  = true;
transferFlags.transferDir = HSMCI_DATA_TRANSFER_DIR_READ;
transferFlags.transferType = HSMCI_DATA_TRANSFER_TYPE_SINGLE;

// Set the block size to 512 bytes
HSMCI_BlockSizeSet(512);

// Set the block count to 1
HSMCI_BlockCountSet(1);

// Set up the DMA to read 512 btyes of data
HSMCI_DmaSetup(readBuffer, 512, HSMCI_DATA_TRANSFER_DIR_READ);

// Send command to read one block of data from SD card starting at block address 100
HSMCI_CommandSend(17, 100, HSMCI_CMD_RESP_R1, transferFlags);

// Check the status of isCommandCompleted and isDataCompleted

// Other tasks ..
</code></pre>
<p>}
```</p>
<h2>Library Interface</h2>
<p>High Speed MultiMedia Card Interface peripheral library provides the following interfaces:</p>
<p>Functions</p>
<p>Data types and constants</p>
<table class="data-table">
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>HSMCI_BusWidthSet</td>
<td>Configures the width of the data bus</td>
</tr>
<tr>
<td>HSMCI_SpeedModeSet</td>
<td>Sets the bus speed</td>
</tr>
<tr>
<td>HSMCI_BlockSizeSet</td>
<td>Sets the size of the one data block of transfer</td>
</tr>
<tr>
<td>HSMCI_BlockCountSet</td>
<td>Sets the number of blocks to transfer</td>
</tr>
<tr>
<td>HSMCI_IsCmdLineBusy</td>
<td>Returns the status of the command line</td>
</tr>
<tr>
<td>HSMCI_IsDatLineBusy</td>
<td>Returns the status of the data line</td>
</tr>
<tr>
<td>HSMCI_ClockSet</td>
<td>Sets the High Speed MultiMedia Card Interface clock frequency</td>
</tr>
<tr>
<td>HSMCI_CommandErrorGet</td>
<td>Returns the errors associated with a command transfer</td>
</tr>
<tr>
<td>HSMCI_DataErrorGet</td>
<td>Returns the errors associated with a data transfer</td>
</tr>
<tr>
<td>HSMCI_ResponseRead</td>
<td>Reads the specified response register</td>
</tr>
<tr>
<td>HSMCI_Initialize</td>
<td>Initializes the HSMCI peripheral and the internal data structures used by the peripheral library</td>
</tr>
<tr>
<td>HSMCI_ModuleInit</td>
<td>Initializes the HSMCI peripheral</td>
</tr>
<tr>
<td>HSMCI_CallbackRegister</td>
<td>This function allows a HSMCI PLIB client to set an event handler</td>
</tr>
<tr>
<td>HSMCI_CommandSend</td>
<td>This function allows the client to send a SD command on the HSMCI interface</td>
</tr>
<tr>
<td>HSMCI_DmaSetup</td>
<td>Sets up the DMA for data transfers</td>
</tr>
</tbody>
</table>
<table class="data-table">
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>HSMCI_DATA_TRANSFER_TYPE</td>
<td>Enum</td>
<td>The enumeration lists single or multi block data transfer type</td>
</tr>
<tr>
<td>HSMCI_DATA_TRANSFER_DIR</td>
<td>Enum</td>
<td>The enumeration lists the direction of the data transfer</td>
</tr>
<tr>
<td>HSMCI_DataTransferFlags</td>
<td>Struct</td>
<td>The data structure is used by the client to provide information</td>
</tr>
<tr>
<td>about the data transfer to the HSMCI PLIB</td>
<td></td>
<td></td>
</tr>
<tr>
<td>HSMCI_ERROR_FLAGS</td>
<td>Enum</td>
<td>The enumeration lists the possible error types for a command and data transfer</td>
</tr>
<tr>
<td>HSMCI_BUS_WIDTH</td>
<td>Enum</td>
<td>The enumeration lists the bus widths for the HSMCI bus</td>
</tr>
<tr>
<td>HSMCI_SPEED_MODE</td>
<td>Enum</td>
<td>The enumeration lists the bus widths for the HSMCI bus</td>
</tr>
<tr>
<td>HSMCI_READ_RESPONSE_REG</td>
<td>Enum</td>
<td>The enumeration lists the response registers that can be read for a given command</td>
</tr>
<tr>
<td>HSMCI_XFER_STATUS</td>
<td>Enum</td>
<td>The enumeration lists the status of the transfer</td>
</tr>
<tr>
<td>HSMCI_CALLBACK</td>
<td>Typedef</td>
<td>The prototype of the HSMCI callback function</td>
</tr>
<tr>
<td>HSMCI_CMD_ERROR</td>
<td>Macro</td>
<td>The macro is a bit wise OR of all the possible errors corresponding to a command transfer</td>
</tr>
</tbody>
</table>
            </main>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>